<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cartSQL">
	
	<insert id="insertCart" parameterType="Cart">
		INSERT INTO CART (CARTNO, CARTUSERID, PNO, AMOUNT, PNAME, PPRICE)
		VALUES (SEQ_CARTNO.NEXTVAL, #{ cartUserId }, #{ pNo }, #{ amount }, #{ pName }, #{ pPrice })
	</insert>
	
	<select id="listCart" resultType="Cart">
		SELECT C.*, (PPRICE * AMOUNT) ORDERPRICE, PA.CHANGENAME, PA.PNO AS ATTACHMENTPNO
		FROM CART C, PATTACHMENT PA
		WHERE C.PNO = PA.PNO
		  AND C.CARTUSERID = #{ cartUserId }
		ORDER BY C.CARTNO DESC
	</select>
	
	<select id="sumPrice" resultType="int">
		SELECT NVL(SUM(PPRICE*AMOUNT), 0) ORDERPRICE
		FROM CART
		WHERE PNO = #{ pNo }
		  AND CARTUSERID = #{ cartUserId }
	</select>
	
	<update id="modifyCart" parameterType="Cart">
		UPDATE TABLE CART
		SET AMOUNT = #{ amount }
		WHERE CARTUSERID = #{ cartUserId }
		AND CARTNO = #{ cartNo }
	</update>
	
	<delete id="deleteCart" parameterType="int">
		DELETE FROM CART
		WHERE CARTNO = #{ cartNo }
	</delete>
	
	<select id="countCart" resultType="int">
		SELECT COUNT(*)
		FROM CART
		WHERE CARTUSERID = #{ cartUserId }
		AND PNO = #{ pNo }
	</select>
	
	<update id="updateCart" parameterType="Cart">
		UPDATE CART
		SET AMOUNT = AMOUNT + #{ amount }
		WHERE CARTUSERID = #{ cartUserId }
		AND PNO = #{ pNo }
	</update>
	
	<!-- Access to #{ field } -->
</mapper>
